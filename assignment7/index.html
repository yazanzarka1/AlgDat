<!DOCTYPE html>
<html>
<head>
    <title>Route and POI Viewer</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
        #controls { padding: 10px; background: #f0f0f0; border-bottom: 2px solid #ccc; }
        #map { height: 100vh; width: 100%; }
        button { margin: 5px; padding: 8px 16px; cursor: pointer; background: #4CAF50; color: white; border: none; border-radius: 4px; }
        button:hover { background: #45a049; }
        .file-btn { background: #2196F3; }
        .file-btn:hover { background: #0b7dda; }
        #status { margin-left: 10px; font-weight: bold; color: #333; }
        .info { padding: 10px; background: #fff3cd; margin: 10px; border-left: 4px solid #ffc107; position: relative; }
        .info strong { color: #856404; }
        .close-btn { position: absolute; top: 5px; right: 10px; cursor: pointer; font-size: 20px; color: #856404; background: none; border: none; padding: 0; }
        .close-btn:hover { color: #000; }
        .hidden { display: none; }
        .file-input-wrapper { display: inline-block; margin: 5px; }
        .file-input-wrapper input[type=file] { display: none; }
        .file-input-wrapper label { padding: 8px 16px; background: #2196F3; color: white; border-radius: 4px; cursor: pointer; display: inline-block; }
        .file-input-wrapper label:hover { background: #0b7dda; }
    </style>
</head>
<body>
    <div id="controls">
        <div class="file-input-wrapper">
            <label for="routeFile">üìÇ Load Route File</label>
            <input type="file" id="routeFile" accept=".txt" onchange="loadFileInput(event, 'route')">
        </div>
        <div class="file-input-wrapper">
            <label for="poisFile">üìÇ Load POIs File</label>
            <input type="file" id="poisFile" accept=".txt" onchange="loadFileInput(event, 'pois')">
        </div>
        <span id="status"></span>
    </div>
    <div class="info" id="instructions">
        <button class="close-btn" onclick="document.getElementById('instructions').classList.add('hidden')">&times;</button>
        <strong>‚ö† Instructions:</strong><br>
        1. Run the program to generate path.txt or nearest_pois.txt<br>
        2. Click the buttons above and select the generated file
    </div>
    <div id="map"></div>

    <script>
        const map = L.map('map').setView([63.4, 10.4], 6);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        let routeLayer = null;
        let poisLayer = null;

        function loadFileInput(event, type) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                plotData(text, type);
                document.getElementById('status').textContent = `‚úì Loaded ${file.name}`;
                document.getElementById('status').style.color = 'green';
            };
            reader.onerror = function(e) {
                document.getElementById('status').textContent = `‚úó Error reading file`;
                document.getElementById('status').style.color = 'red';
            };
            reader.readAsText(file);
        }

        function plotData(text, type) {
            const lines = text.trim().split('\n');
            const coords = lines.map(line => {
                const [lat, lon] = line.split(',').map(parseFloat);
                return [lat, lon];
            }).filter(coord => !isNaN(coord[0]) && !isNaN(coord[1]));

            if (coords.length === 0) {
                document.getElementById('status').textContent = '‚úó No valid coordinates found';
                document.getElementById('status').style.color = 'red';
                return;
            }

            if (type === 'route') {
                if (routeLayer) map.removeLayer(routeLayer);
                routeLayer = L.polyline(coords, {color: 'blue', weight: 3}).addTo(map);
                
                // Add start marker
                L.marker(coords[0], {
                    icon: L.divIcon({className: 'start-marker', html: 'üö©', iconSize: [30, 30]})
                }).addTo(map).bindPopup('Start');
                
                // Add end marker
                L.marker(coords[coords.length - 1], {
                    icon: L.divIcon({className: 'end-marker', html: 'üèÅ', iconSize: [30, 30]})
                }).addTo(map).bindPopup('End');
                
                map.fitBounds(routeLayer.getBounds());
            } else {
                if (poisLayer) map.removeLayer(poisLayer);
                poisLayer = L.layerGroup().addTo(map);
                
                // First coordinate is the search origin
                if (coords.length > 0) {
                    L.marker(coords[0], {
                        icon: L.divIcon({className: 'start-marker', html: 'üìç', iconSize: [30, 30]})
                    }).addTo(poisLayer).bindPopup('Search Origin');
                    
                    // Plot remaining coordinates as POIs
                    for (let i = 1; i < coords.length; i++) {
                        L.circleMarker(coords[i], {
                            radius: 8,
                            fillColor: '#ff0000',
                            color: '#000',
                            weight: 1,
                            opacity: 1,
                            fillOpacity: 0.8
                        }).addTo(poisLayer).bindPopup(`POI ${i}<br>Lat: ${coords[i][0].toFixed(6)}<br>Lon: ${coords[i][1].toFixed(6)}`);
                    }
                    
                    const bounds = L.latLngBounds(coords);
                    map.fitBounds(bounds);
                }
            }
        }

        // Try to auto-load files if running from a server
        window.addEventListener('load', function() {
            if (window.location.protocol !== 'file:') {
                // Running from server, try to auto-load
                fetch('path.txt')
                    .then(response => response.ok ? response.text() : null)
                    .then(text => {
                        if (text) {
                            plotData(text, 'route');
                            document.getElementById('status').textContent = '‚úì Auto-loaded path.txt';
                            document.getElementById('status').style.color = 'green';
                        }
                    })
                    .catch(() => {});
            }
        });
    </script>
</body>
</html>
